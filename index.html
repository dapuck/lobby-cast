<html>
  <head>
    <title>Lobby Cast</title>
    <script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js"></script>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script>
      if(typeof console === 'undefined' || typeof console.log === 'undefined') {
        console = {
          log: function(){}
        };
      }
      
      (function($) {
        var castAppId = '4BCF9ABD';
        var message_nsp = 'urn:x-cast:ianmccallcodes.lobycast';
        var session = null;
        
        function initCastApi() {
          var sessionRequest = new chrome.cast.SessionRequest(castAppId);
          var apiConfig = new chrome.cast.ApiConfig(sessionRequest, sessionListener, receiverListener);
          chrome.cast.initialize(apiConfig, function(){}, function(err) {
            console.log(err);
          });
        }
        
        function sessionListener(e) {
          session = e;
          session.addUpdateListener(sessionUpdateListener);
          session.addMessageListener(message_nsp, messageHandler);
          console.log(e);
          sendConfig();
        }
        
        function receiverListener(e) {
          if(e === chrome.cast.ReceiverAvailability.AVAILABLE) {
            
          }
        }
        
        function messageHandler(e) {
          console.log(e);
        }
        
        function sessionUpdateListener(isAlive) {
          if(!isAlive) {
            session = null;
          }
        }
        
        function startCast() {
          
        }

        function sendConfig() {
          var conf = {
            left: {
              type: "twitter",
              options: {
                widget_id: 501472815405481984
              }
            },
            center: {
              type: "message",
              options: {
                title: "Development",
                body: "Chicago, IL"
              }
            }
          };
          session.sendMessage(message_nsp, conf, function() {}, function() {});
        }
        
        window['__onGCastApiAvailable'] = function(loaded, err) {
          if(loaded) {
            initCastApi();
          }
        }
      })(jQuery);
    </script>
  </head>
  <body>
    <!--h1>Hello World</h1-->
    <input type="button" id="cast" value="Cast">
  </body>
</html>
